{{right_sidebar_enabled=True}}
{{extend 'layout.html'}}

{{block header}}

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h1>{{=T('Resource')}}</h1>
            <hr>
        </div>
    </div>
</div>
{{end}}

<div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <ul class="nav nav-pills">

            <li id="back-button" role="presentation" ><a onclick="history.go(-1);return false;" class='btn btn-default'><ico class="glyphicon glyphicon-arrow-left"></ico> {{=T('Back')}}</a></li>

            {{if resource:}}
                <li role="presentation">
                  <ul class="nav nav-pills">
                      {{if(auth.user==None):}}
                          {{=LI(A(T("Login to voted"),_href=URL('default', 'user', args="login", vars=dict(_next=URL('view', args=resource.id, vars=request.vars))), _id="btn-voted"))}}
                          {{=LI(LOAD('resource','vote.load', args=[resource.id], user_signature=True, content=IMG(_src=URL("static","images/loader.gif"), _width="5%")))}}
                    </ul>
                    {{else:}}
                       {{=LOAD('resource','add_vote.load', ajax=True, args=[resource.id], user_signature=True,  content=IMG(_src=URL("static","images/loader.gif"), _width="5%"))}}
                    {{pass}}
                </li>
           {{pass}}
        </ul>
        <br />
    </div>
</div>

{{if resource:}}

    <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">

                <ul class="nav">
                    <li>
                        <div class="col-lg-3 col-md-3 col-sm-4 col-xs-6">
                            <figure class="figure figure-text">
                                <img src="{{=URL('default', 'download', args=resource.coverpag)}}" class="img-rounded" alt="">
                                <figcaption class="figure-caption fig-caption-text">{{=A(XML('<ico class="glyphicon glyphicon-download"></ico>'), _title=T('Download'), _href=URL('resource', 'download.html', args=[resource.id, resource.resource]), _class='btn btn-success', **{"_data-toggle" : "tooltip", "_data-placement": "right"})}}</figcaption>
                            </figure>
                        </div>

                        <div class="col-lg-9 col-md-9 col-sm-8 col-xs-6">
                            <ul class="nav">
                                {{=LI(H3(str(resource.title).upper()))}}

                                {{if resource.author:}}
                                    {{=LI(H4(T("By: ")+', '.join(["%s" % k.upper() for k in resource.author])))}}
                                {{pass}}

                                {{if resource.publisher:}}
                                    {{=LI(H4(CAT(T("Publisher: "), resource.publisher.name.upper())))}}
                                {{pass}}

                                {{=LI(H4(str("%.2f" % round(resource.size,2))+" "+str(resource.unit)))}}

                                {{if resource.keyword:}}
                                    {{=LI(H4(T("Keywords: ")+', '.join(["%s" % k.upper() for k in resource.keyword])))}}
                                {{pass}}

                                {{if resource.year:}}
                                    {{=LI(H4(CAT(T("Year:"), resource.year)))}}
                                {{pass}}

                            </ul>

                            <a class="btn-search" data-toggle="collapse" data-target="#data">{{=T("See More")}}</a>

                            <div id="data" class="collapse" >
                                <ul class="nav">
                                    {{=LI(XML(resource.description))}}

                                    {{if resource.rtype:}}
                                        {{=LI(H4(CAT(T("Type:"),' ', resource.rtype.name)))}}
                                    {{pass}}

                                    {{if resource.created_by:}}
                                        {{=LI(H4(CAT(T("Uploaded by:"),' ', resource.created_by.username)))}}
                                    {{pass}}

                                    {{if resource.category:}}
                                        {{=LI(H4(CAT(T("Category:"),' ', resource.category.name)))}}
                                    {{pass}}

                                    {{if resource.mime_type:}}
                                        {{=LI(H4(CAT(T("Extention:"),' ', resource.mime_type)))}}
                                    {{pass}}

                                    {{if resource.downloads:}}
                                        {{=LI(H4(CAT(T("Downloads:"),' ', resource.downloads)))}}
                                    {{pass}}

                                    {{if resource.visits:}}
                                        {{=LI(H4(CAT(T("Visits:"),' ', resource.visits)))}}
                                    {{pass}}

                                </ul>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <hr >
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            {{=H2(T("Comments"))}}
        </div>
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            {{if(auth.user==None):}}
               {{=LOAD('resource','comment.load', ajax=True, args=[resource.id], user_signature=True, content=IMG(_src=URL("static","images/loader.gif"), _width="5%"))}}
               {{=A(CAT(T("Login to comment")," ",XML('<ico class="ico icon-comment"></ico> ')),_href=URL('default', 'user', args="login", vars=dict(_next=URL('view', args= resource.id, vars= request.vars))), _class="btn")}}
            {{else:}}
               {{=LOAD('resource','add_comment.load', ajax=True, args=[resource.id], user_signature=True,  content=IMG(_src=URL("static","images/loader.gif"), _width="5%"))}}
            {{pass}}
        </div>
    </div>

{{else:}}
    {{=H2(T("Resource not find"))}}
{{pass}}

{{block page_js}}
    {{super}}
    <script>
         $(function() {
             if (history.length == 1){
                 $("#back-button").hide();
             }

             $(".btn-search").click(function(){
                 if ($(this).text() == '{{=T("See More")}}'){
                     $(this).text('{{=T("See Less")}}');
                 }else{
                     $(this).text('{{=T("See More")}}');
                 }
             });
        });
    </script>
{{end}}
